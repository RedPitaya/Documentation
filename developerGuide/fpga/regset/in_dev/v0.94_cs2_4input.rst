.. _fpga_094_cs2_4input:

================================================================
CS[2] - Oscilloscope CH C/D (4-Input) (0x40200000-0x402FFFFF)
================================================================

**FPGA Project:** :ref:`v0.94 <fpga_projects>`

**Board:** STEMlab 125-14 4-Input

This document describes the CS[2] register space for the STEMlab 125-14 4-Input board. On this board, CS[2] contains 
Oscilloscope channels C and D instead of the Arbitrary Signal Generator found on other boards.

.. note::

    **Register Synchronization**

    Register writes are synchronized between channels A/B (CS[1]) and C/D (CS[2]) on the 4-Input board.
    The output registers are replaced with a mirrored version of the input registers for channels C/D (IN3/IN4).

.. contents::
    :local:
    :depth: 1
    :backlinks: top

|


Quick Reference
---------------

.. tabularcolumns:: |p{25mm}|p{105mm}|p{10mm}|

+--------------------+--------------------------------------------------------------+-------+
| Address Offset     | Description                                                  | R/W   |
+====================+==============================================================+=======+
| 0x0                | Configuration (trigger control, arm/reset)                   | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x4                | Trigger source selection                                     | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x8-0xC            | CH C/D thresholds                                            | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x10-0x14          | Delay after trigger and decimation factor                    | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x18-0x1C          | Write pointers (current, trigger)                            | R     |
+--------------------+--------------------------------------------------------------+-------+
| 0x20-0x24          | CH C/D threshold hysteresis                                  | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x28               | Enable signal average at decimation                          | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x2C               | PreTrigger counter                                           | R     |
+--------------------+--------------------------------------------------------------+-------+
| 0x30-0x3C          | CH C equalization filter coefficients (AA, BB, KK, PP)       | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x40-0x4C          | CH D equalization filter coefficients (AA, BB, KK, PP)       | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x50-0x5C          | CH C AXI DMA control (addresses, delay, enable)              | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x60-0x64          | CH C AXI write pointers (trigger, current)                   | R     |
+--------------------+--------------------------------------------------------------+-------+
| 0x70-0x7C          | CH D AXI DMA control (addresses, delay, enable)              | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x80-0x84          | CH D AXI write pointers (trigger, current)                   | R     |
+--------------------+--------------------------------------------------------------+-------+
| 0x90               | Trigger debouncer time                                       | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0xA0-0xA8          | Accumulator (sequence length, CH C/D offset correction)      | R/W   |
+--------------------+--------------------------------------------------------------+-------+
| 0x10000-0x1FFFC    | CH C memory data buffer (16k samples)                        | R     |
+--------------------+--------------------------------------------------------------+-------+
| 0x20000-0x2FFFC    | CH D memory data buffer (16k samples)                        | R     |
+--------------------+--------------------------------------------------------------+-------+

|


Trigger Sources
----------------

The trigger source register (0x4) accepts the following values:

+-------+------------------------------------------------+
| Value | Trigger Source                                 |
+=======+================================================+
| 1     | Trigger immediately                            |
+-------+------------------------------------------------+
| 2     | CH A threshold positive edge                   |
+-------+------------------------------------------------+
| 3     | CH A threshold negative edge                   |
+-------+------------------------------------------------+
| 4     | CH B threshold positive edge                   |
+-------+------------------------------------------------+
| 5     | CH B threshold negative edge                   |
+-------+------------------------------------------------+
| 6     | External trigger positive edge (DIO0_P pin)    |
+-------+------------------------------------------------+
| 7     | External trigger negative edge                 |
+-------+------------------------------------------------+
| 8     | AWG application positive edge                  |
+-------+------------------------------------------------+
| 9     | AWG application negative edge                  |
+-------+------------------------------------------------+
| 10    | CH C threshold positive edge (4-Input only)    |
+-------+------------------------------------------------+
| 11    | CH C threshold negative edge (4-Input only)    |
+-------+------------------------------------------------+
| 12    | CH D threshold positive edge (4-Input only)    |
+-------+------------------------------------------------+
| 13    | CH D threshold negative edge (4-Input only)    |
+-------+------------------------------------------------+

|


Triggering and Acquisition Control
-----------------------------------

This section covers all registers related to triggering configuration, threshold detection, and acquisition timing.

Configuration
~~~~~~~~~~~~~~

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x0**            | **Configuration**                                            |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:5  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Acquisition delay complete (all data written to buffer)      |    4  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Trigger remains armed after acquisition delay completes      |    3  |   W |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Trigger has arrived (stays 1 until next arm or reset)        |    2  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reset write state machine                                    |    1  |   W |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Start writing data into memory (ARM trigger)                 |    0  |   W |
+--------------------+--------------------------------------------------------------+-------+-----+


Trigger Source and Thresholds
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x4**            | **Trigger source** - See trigger source table above          |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:4  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Trigger source selector (when trigger delay ends → 0)        |  3:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x8**            | **CH C threshold**                                           |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Trigger when ADC value crosses this threshold                | 13:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0xC**            | **CH D threshold**                                           |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Trigger when ADC value crosses this threshold                | 13:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x20**           | **CH C hysteresis**                                          |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Threshold hysteresis - value must be outside to re-trigger   | 13:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x24**           | **CH D hysteresis**                                          |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Threshold hysteresis - value must be outside to re-trigger   | 13:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+

.. tip::

    **Hysteresis usage:** Set hysteresis to prevent trigger noise. The signal must move outside 
    the hysteresis band before the trigger can fire again.

Trigger Timing
~~~~~~~~~~~~~~

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x10**           | **Delay after trigger**                                      |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Number of decimated samples to capture after trigger         | 31:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x2C**           | **PreTrigger Counter**                                       |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Unsigned counter holding the number of samples               | 31:0  | R   |
|                    | captured between acquisition start and trigger.              |       |     |
|                    | Stops incrementing at 0xffffffff (no overflow).              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x90**           | **Trigger debouncer time**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Number of ADC clock periods trigger is disabled              | 19:0  | R/W |
|                    | after activation reset value is decimal 62500 or             |       |     |
|                    | equivalent to 0.5 ms                                         |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+

|


Data Processing
---------------

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x14**           | **Data decimation**                                          |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:17 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Decimation factor:                                           | 16:0  | R/W |
|                    |   * 1, 2, 4, 8: Supported for values < 16                    |       |     |
|                    |   * ≥16: Averaging of any number supported (max 65535)       |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x28**           | **Signal average enable**                                    |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:1  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Enable signal average at decimation                          |    0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+

|

Write Pointers and Status
--------------------------

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x18**           | **Write pointer - current**                                  |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Current write pointer                                        | 13:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x1C**           | **Write pointer - trigger**                                  |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Write pointer at time when trigger arrived                   | 13:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+

|


Equalization Filters
----------------------

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x30**           | **CH C Equalization filter AA**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:18 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | AA Coefficient                                               | 17:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x34**           | **CH C Equalization filter BB**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:25 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | BB Coefficient                                               | 24:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x38**           | **CH C Equalization filter KK**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:25 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | KK Coefficient                                               | 24:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x3C**           | **CH C Equalization filter PP**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:25 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | PP Coefficient                                               | 24:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x40**           | **CH D Equalization filter AA**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:18 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | AA Coefficient                                               | 17:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x44**           | **CH D Equalization filter BB**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:25 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | BB Coefficient                                               | 24:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x48**           | **CH D Equalization filter KK**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:25 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | KK Coefficient                                               | 24:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x4C**           | **CH D Equalization filter PP**                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:25 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | PP Coefficient                                               | 24:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+

|


AXI DMA Configuration
----------------------

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x50**           | **CH C AXI lower address**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Starting write address                                       | 31:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x54**           | **CH C AXI upper address**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Address where it wraps to lower address                      | 31:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x58**           | **CH C AXI delay after trigger**                             |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Number of decimated samples to write after trigger           | 31:0  | R/W |
|                    |                                                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x5C**           | **CH C AXI enable master**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:1  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Enable AXI master                                            |    0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x60**           | **CH C AXI write pointer - trigger**                         |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Write pointer at time when trigger arrived                   | 31:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x64**           | **CH C AXI write pointer - current**                         |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Current write pointer                                        | 31:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x70**           | **CH D AXI lower address**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Starting write address                                       | 31:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x74**           | **CH D AXI upper address**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Address where it wraps to lower address                      | 31:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x78**           | **CH D AXI delay after trigger**                             |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Number of decimated samples to write after trigger           | 31:0  | R/W |
|                    |                                                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x7C**           | **CH D AXI enable master**                                   |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:1  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Enable AXI master                                            |    0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x80**           | **CH D AXI write pointer - trigger**                         |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Write pointer at time when trigger arrived                   | 31:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x84**           | **CH D AXI write pointer - current**                         |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Current write pointer                                        | 31:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+

|


Calibration Registers
------------------------

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0xA0**           | **Accumulator data sequence length**                         |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0xA4**           | **Accumulator data offset correction CH C**                  |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Signed offset value                                          | 13:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0xA8**           | **Accumulator data offset correction CH D**                  |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:14 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Signed offset value                                          | 13:0  | R/W |
+--------------------+--------------------------------------------------------------+-------+-----+

|


Memory Data Buffers
--------------------

.. tabularcolumns:: |p{15mm}|p{105mm}|p{15mm}|p{15mm}|

+--------------------+--------------------------------------------------------------+-------+-----+
| Offset             | Description                                                  | Bits  | R/W |
+====================+==============================================================+=======+=====+
| **0x10000 to       | **Memory data (16k samples)**                                |       |     |
| 0x1FFFC**          |                                                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:16 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Captured data for CH C                                       | 15:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
| **0x20000 to       | **Memory data (16k samples)**                                |       |     |
| 0x2FFFC**          |                                                              |       |     |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Reserved                                                     | 31:16 | R   |
+--------------------+--------------------------------------------------------------+-------+-----+
|                    | Captured data for CH D                                       | 15:0  | R   |
+--------------------+--------------------------------------------------------------+-------+-----+

|

:ref:`Back to main register map <fpga_094_dev>`
